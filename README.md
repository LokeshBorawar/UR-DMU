# Anomaly detection in surveillance videos using [UR-DMU](https://github.com/henrryzh1/UR-DMU.git)

Added some demo codes.

- Videos are split into fixed-size length (16 frames). TO understand overall structure: if a video has 529 frames, it can be divided into 33 full 16-frame segments (529//16), and the last segment will be padded by repeating the last frame to form 16 frames. This creates 34 segments of (1, 3, 16, 224, 224), which are then passed through a pre-trained I3D model to extract features, resulting in (1, 34, 1024). These features are then processed by an anomaly score prediction model, yielding (1, 34) anomaly scores. Each score is repeated 16 times to cover the original 529 frames.

- If oversampling is used (10 crop), the video of 544 frames (15 repeated frames) is split into segments of [(10, 3, 16, 224, 224)]x34 where batch dimension represents 10 crop of each segment, resulting in features of shape (10, 34, 1024). The model processes oversampled data as a batch (1 * 10, 34, 1024), and the final output is averaged across the oversample dimension to give anomaly scores of shape (1, 34). These scores are then applied to the original 529 frames.

- The [Anomaly_detection_demo](Anomaly_detection_demo.py) code is using oversamplig method. Below scores are generated by taking every frame. Means, each 16 frame segment or clip is created without even single frame. See the complete video in the [Out directory](feature_extract/Out/skip_frame_1).
![sf1_abuse](feature_extract/Out/skip_frame_1/abuse.gif)
![sf1_explosion](feature_extract/Out/skip_frame_1/explosion.gif)
![sf1_fight](feature_extract/Out/skip_frame_1/fight.gif)
![sf1_roadaccident](feature_extract/Out/skip_frame_1/roadaccident.gif)

- These score below are generated by setting skip frame by 5. Means every 5th frame is taken to prepare a segment containg 16 frames. The complete videos are available in the [Out directory](feature_extract/Out/skip_frame_5).
![sf5_abuse](feature_extract/Out/skip_frame_5/abuse.gif)
![sf5_explosion](feature_extract/Out/skip_frame_5/explosion.gif)
- As in below fight, using every 5th frame reducing number of anomaly frames in a segment so probability getting down. But, it also reduced score when fight is not happening.
![sf5_fight](feature_extract/Out/skip_frame_5/fight.gif)
- Just a few frames of anomaly is hard to score. When skip by 5, number of frames in the segment that going to have anomaly frame is very less so score getting down.
![sf5_roadaccident](feature_extract/Out/skip_frame_5/roadaccident.gif)

- Without oversamlpling means, model needs (224, 224) croped frames from a video. So, it may left the anomaly or part of it. This score generated by [AD_Vis](AD_Vis.py), without oversampling.
![wo](feature_extract/Out/roadaccident.gif)

- In detail, [i3d_extract](feature_extract/i3d_extract.py) takes frames but need to save all [video's](feature_extract/Data/roadaccident) [frames](feature_extract/UCF_Crime_Frames/roadaccident) using [video2frame_split](feature_extract/video2frame_split.py) and convert to segments with oversampling and save as [.npy](feature_extract/UCF_ten/roadaccident_i3d.npy). After that [UR_DMU_demo](UR_DMU_demo.py) can be use to predict anomaly score.


## Contacts:
- borawarlokesh26@gmail.com


## Credits:
- [UR-DMU](https://github.com/henrryzh1/UR-DMU.git)